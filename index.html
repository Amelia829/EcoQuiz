<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ìƒíƒœÂ·í™˜ê²½ í€´ì¦ˆ ê²Œì„ â€” 10ë¬¸ì œ</title>
<style>
  :root{
    --blue-strong: #007BFF;
    --blue-deep: #0056d6;
    --orange: #FF6B00;
    --muted: #f5f7fb;
    --white: #ffffff;
    --card-radius: 18px;
    --glass: rgba(255,255,255,0.06);
    --shadow: 0 10px 30px rgba(2,6,23,0.15);
    --accent-shadow: 0 6px 18px rgba(0,123,255,0.12);
  }

  html,body{
    height:100%;
    margin:0;
    font-family: "Inter", "Noto Sans KR", system-ui, -apple-system, 'Segoe UI', Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(135deg, #E8F2FF 0%, #FFF7EF 100%);
    color: #0b1220;
  }

  /* full screen layout */
  .wrap{
    min-height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:40px;
    box-sizing:border-box;
  }

  .container{
    width:100%;
    max-width:1100px;
    height:calc(100vh - 80px);
    display:flex;
    gap:28px;
    align-items:stretch;
  }

  /* left: progress / branding */
  .panel-left{
    flex:0 0 320px;
    background: linear-gradient(180deg,var(--white), #F8FBFF);
    border-radius:var(--card-radius);
    padding:28px;
    box-shadow: var(--shadow);
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    overflow:hidden;
  }

  .brand{
    display:flex;
    gap:14px;
    align-items:center;
  }
  .logo{
    width:62px;
    height:62px;
    border-radius:14px;
    background:linear-gradient(135deg,var(--blue-strong),var(--blue-deep));
    display:flex;
    align-items:center;
    justify-content:center;
    color:var(--white);
    font-weight:800;
    font-size:22px;
    box-shadow: var(--accent-shadow);
  }
  .brand h1{
    margin:0;
    font-size:18px;
    letter-spacing:-0.3px;
  }
  .brand p{ margin:4px 0 0; color:#6b7280; font-size:13px; }

  .progress-wrap{
    margin-top:18px;
  }
  .progress-bar{
    width:100%;
    height:14px;
    background:linear-gradient(90deg,#eef4ff,#fff3ec);
    border-radius:999px;
    overflow:hidden;
    box-shadow:inset 0 -2px 6px rgba(0,0,0,0.03);
  }
  .progress-bar > i{
    display:block;
    height:100%;
    width:0%;
    background: linear-gradient(90deg,var(--blue-strong),var(--orange));
    transition: width .45s cubic-bezier(.2,.9,.3,1);
  }
  .meta{
    display:flex;
    justify-content:space-between;
    margin-top:10px;
    font-size:13px;
    color:#475569;
  }

  .stats{
    display:flex;
    gap:10px;
    margin-top:18px;
  }
  .stat{
    background: linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.6));
    padding:12px;
    border-radius:12px;
    text-align:center;
    flex:1;
    box-shadow: 0 6px 18px rgba(255,107,0,0.06);
  }
  .stat strong{ display:block; font-size:18px; color:var(--blue-deep); }
  .stat span{ color:#6b7280; font-size:12px; }

  .left-footer{
    text-align:center;
    font-size:13px;
    color:#6b7280;
    margin-top:12px;
  }

  /* main quiz card */
  .panel-right{
    flex:1;
    background: linear-gradient(180deg, rgba(255,255,255,0.9), var(--muted));
    border-radius:var(--card-radius);
    padding:28px;
    box-shadow: var(--shadow);
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    position:relative;
    overflow:hidden;
  }

  .question-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  .q-index{
    font-weight:700;
    font-size:14px;
    color:var(--blue-deep);
  }
  .q-title{
    font-size:20px;
    font-weight:600;
    color:#071237;
    margin-top:16px;
    line-height:1.25;
  }

  .question-card{
    margin-top:18px;
    display:grid;
    gap:12px;
  }

  .choices{
    display:grid;
    gap:12px;
  }
  .choice{
    cursor:pointer;
    padding:14px 16px;
    border-radius:12px;
    background:var(--white);
    border:1px solid rgba(2,6,23,0.06);
    box-shadow: 0 6px 18px rgba(2,6,23,0.03);
    transition: transform .14s ease, box-shadow .14s ease, border-color .14s ease;
    display:flex;
    align-items:center;
    gap:12px;
  }
  .choice:hover{ transform: translateY(-4px); }
  .choice .label{
    min-width:36px;
    height:36px;
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    color:var(--blue-deep);
    background:linear-gradient(180deg,#f8fbff,#ffffff);
    border:1px solid rgba(0,123,255,0.06);
  }
  .choice .text{ font-size:15px; color:#0b1220; }

  .choice.correct{
    background: linear-gradient(90deg, rgba(0,123,255,0.08), rgba(255,107,0,0.06));
    border: 1px solid rgba(0,123,255,0.14);
    box-shadow: 0 6px 18px rgba(0,123,255,0.08);
  }
  .choice.wrong{
    background: linear-gradient(90deg, rgba(255,107,0,0.03), rgba(255,107,0,0.01));
    border: 1px solid rgba(255,107,0,0.12);
    opacity:0.9;
  }

  .actions{
    display:flex;
    gap:12px;
    margin-top:16px;
    align-items:center;
    justify-content:space-between;
  }
  .btn{
    padding:12px 18px;
    border-radius:12px;
    border:0;
    font-weight:700;
    cursor:pointer;
    box-shadow: var(--accent-shadow);
  }
  .btn.primary{
    background: linear-gradient(90deg, var(--blue-strong), var(--blue-deep));
    color:var(--white);
  }
  .btn.ghost{
    background:transparent;
    border:1px solid rgba(7,18,55,0.06);
    color:#071237;
  }
  .btn.orange{
    background: linear-gradient(90deg,var(--orange), #ff8b41);
    color:var(--white);
  }

  /* result overlay */
  .result{
    position:absolute;
    inset:26px;
    border-radius:14px;
    background: linear-gradient(180deg, rgba(255,255,255,0.98), #fff);
    display:none;
    padding:28px;
    box-shadow: 0 30px 60px rgba(2,6,23,0.12);
    z-index:40;
  }
  .result.show{ display:block; animation: pop .28s ease both;}
  @keyframes pop{ from{ transform: scale(.98); opacity:0 } to{ transform:scale(1); opacity:1 } }

  .result h2{ margin:0 0 6px; font-size:22px; color:var(--blue-deep); }
  .result p{ margin:0 0 18px; color:#475569; }

  .result .score{
    display:flex;
    gap:10px;
    align-items:center;
    font-weight:800;
    font-size:34px;
    color:var(--orange);
  }

  .small{
    font-size:13px;
    color:#6b7280;
  }

  /* responsiveness */
  @media (max-width:900px){
    .container{ flex-direction:column; height:auto; }
    .panel-left{ flex:unset; order:2; width:100%; max-width:none; }
    .panel-right{ order:1; height:auto; }
    .wrap{ padding:18px; }
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="container" role="application" aria-label="ìƒíƒœ í™˜ê²½ í€´ì¦ˆ ê²Œì„">
    <aside class="panel-left" aria-hidden="false">
      <div>
        <div class="brand">
          <div class="logo">E</div>
          <div>
            <h1>EcoQuiz</h1>
            <p>ìƒíƒœÂ·í™˜ê²½ í€´ì¦ˆ â€” 10ë¬¸ì œ</p>
          </div>
        </div>

        <div class="progress-wrap" aria-hidden="false">
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <div class="meta">
              <div>ë¬¸ì œ <strong id="meta-q">1</strong>/10</div>
              <div id="meta-time" class="small">ì ìˆ˜: <strong id="meta-score">0</strong></div>
            </div>
          </div>

          <div style="margin-top:12px;">
            <div class="progress-bar" aria-hidden="true"><i id="progress"></i></div>
            <div style="display:flex;justify-content:space-between;margin-top:8px;">
              <span class="small">ì§„í–‰ë„</span>
              <span class="small"><span id="progress-percent">0%</span></span>
            </div>
          </div>

          <div class="stats">
            <div class="stat">
              <strong id="stat-correct">0</strong>
              <span>ì •ë‹µ</span>
            </div>
            <div class="stat">
              <strong id="stat-wrong">0</strong>
              <span>ì˜¤ë‹µ</span>
            </div>
          </div>
        </div>
      </div>

      <div class="left-footer">
        <div class="small">í‚¤ë³´ë“œ: ìˆ«ì 1~4ë¡œ ì„ íƒ, Enterë¡œ ë‹¤ìŒ</div>
        <div style="margin-top:10px;font-size:12px;color:#94a3b8">ìµœê³ ì : <strong id="highscore">0</strong></div>
      </div>
    </aside>

    <main class="panel-right" id="main" tabindex="0">
      <div>
        <div class="question-header">
          <div class="q-index">ë¬¸ì œ <span id="qnum">1</span></div>
          <div class="small" id="difficulty">ë‚œì´ë„: ë³´í†µ</div>
        </div>

        <h2 class="q-title" id="question">ë¡œë”© ì¤‘...</h2>

        <div class="question-card">
          <div class="choices" id="choices" role="listbox" aria-labelledby="question"></div>

          <div class="actions">
            <div style="display:flex;gap:10px;">
              <button class="btn ghost" id="btn-skip" title="ë‹¤ìŒ ë¬¸ì œ" aria-label="ë‹¤ìŒ ë¬¸ì œ">ê±´ë„ˆë›°ê¸°</button>
              <button class="btn" id="btn-explain" title="í•´ì„¤ ë³´ê¸°" aria-label="í•´ì„¤ ë³´ê¸°">í•´ì„¤</button>
            </div>

            <div style="display:flex;gap:10px;">
              <button class="btn orange" id="btn-restart" title="ì²˜ìŒë¶€í„°" aria-label="ì²˜ìŒë¶€í„°">ì²˜ìŒë¶€í„°</button>
              <button class="btn primary" id="btn-next" title="ë‹¤ìŒ" aria-label="ë‹¤ìŒ">ë‹¤ìŒ</button>
            </div>
          </div>
        </div>
      </div>

      <section class="result" id="result" role="dialog" aria-modal="true" aria-hidden="true">
        <h2 id="result-title">ê²°ê³¼</h2>
        <p id="result-desc">ëª¨ë“  ë¬¸ì œë¥¼ í’€ì—ˆì–´!</p>

        <div style="display:flex;align-items:center;justify-content:space-between;margin-top:18px;">
          <div>
            <div class="score" id="final-score">0 / 10</div>
            <div class="small" style="margin-top:6px">ì •ë‹µë¥ : <strong id="final-percent">0%</strong></div>
          </div>
          <div style="text-align:right">
            <div class="small">ìµœê³ ì : <strong id="final-high">0</strong></div>
            <div style="margin-top:10px">
              <button class="btn primary" id="btn-play-again">ë‹¤ì‹œí•˜ê¸°</button>
              <button class="btn ghost" id="btn-close-result">ë‹«ê¸°</button>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>

<script>
/* Quiz data: 10 questions about ecology & environment */
const QUESTIONS = [
  {
    q: "ìƒë¬¼ë‹¤ì–‘ì„±(biodiversity)ì´ ì¤‘ìš”í•œ ì´ìœ ë¡œ ê°€ì¥ ì ì ˆí•˜ì§€ ì•Šì€ ê²ƒì€?",
    choices: ["ìƒíƒœê³„ ì•ˆì •ì„± ìœ ì§€", "ì•½ìš©Â·ì‹ëŸ‰ ë“± ìì› ì œê³µ", "ê¸°í›„ë³€í™”ì˜ ì§ì ‘ì  ì›ì¸", "ìƒíƒœê³„ ì„œë¹„ìŠ¤ ì œê³µ"],
    a: 2,
    explain: "ìƒë¬¼ë‹¤ì–‘ì„±ì€ ìƒíƒœê³„ ì•ˆì •ì„±ê³¼ ì„œë¹„ìŠ¤ ì œê³µ, ìì› ì œê³µì— ê¸°ì—¬í•œë‹¤. ê¸°í›„ë³€í™”ì˜ ì§ì ‘ì  ì›ì¸ì€ ì•„ë‹ˆë‹¤."
  },
  {
    q: "íƒ„ì†Œ í¡ìˆ˜ì›ìœ¼ë¡œ ê°€ì¥ í° ê¸°ì—¬ë¥¼ í•˜ëŠ” ê²ƒì€?",
    choices: ["ëŒ€ê¸° ì¤‘ ì´ì‚°í™”íƒ„ì†Œ", "ì‚°í˜¸ì´ˆ", "ì—´ëŒ€ìš°ë¦¼", "ì‚¬ë§‰"],
    a: 2,
    explain: "ì—´ëŒ€ìš°ë¦¼ì€ ëŒ€ëŸ‰ì˜ íƒ„ì†Œë¥¼ í¡ìˆ˜Â·ì €ì¥í•˜ëŠ” ì¤‘ìš”í•œ íƒ„ì†Œ í¡ìˆ˜ì›ì´ë‹¤."
  },
  {
    q: "ì‚¬ë§‰í™”(desertification)ë¥¼ ì•…í™”ì‹œí‚¤ëŠ” ì£¼ìš” ì›ì¸ì´ ì•„ë‹Œ ê²ƒì€?",
    choices: ["ê³¼ë„í•œ ë°©ëª©", "í† ì§€ì˜ ê³¼ë„í•œ ê²½ì‘", "ì‚°ë¦¼ ë²Œì±„", "ë„ì‹œ ê³µì› ì¡°ì„±"],
    a: 3,
    explain: "ë„ì‹œ ê³µì› ì¡°ì„±ì€ í† ì§€ë¥¼ ë” ê±´ê°•í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆì–´ ì‚¬ë§‰í™”ë¥¼ ì•…í™”ì‹œí‚¤ì§€ ì•ŠëŠ”ë‹¤."
  },
  {
    q: "í•´ì–‘ ì‚°ì„±í™”(ocean acidification)ì˜ ì£¼ ì›ì¸ì€?",
    choices: ["í•´ìˆ˜ ì˜¨ë„ í•˜ë½", "ì´ì‚°í™”íƒ„ì†Œ ì¦ê°€", "í”Œë‘í¬í†¤ ê°ì†Œ", "í•´ë¥˜ì˜ ë³€í™”"],
    a: 1,
    explain: "ëŒ€ê¸° ì¤‘ ì´ì‚°í™”íƒ„ì†Œê°€ í•´ì–‘ì— í¡ìˆ˜ë˜ë©° í•´ìˆ˜ì˜ pH ë¥¼ ë‚®ì¶˜ë‹¤."
  },
  {
    q: "ì§€êµ¬ì˜¨ë‚œí™”ë¡œ ê¸°ëŒ€í•˜ê¸° ì–´ë ¤ìš´ ì˜í–¥ì€?",
    choices: ["ê·¹ì§€ë°©ì˜ ë¹™í•˜ ê°ì†Œ", "í•´ìˆ˜ë©´ ìƒìŠ¹", "ìƒë¬¼ê³„ì˜ ì¼ë¶€ ë©¸ì¢… ìœ„í—˜ ì¦ê°€", "ëŒ€ê¸° ì¤‘ ì‚°ì†Œ ë¹„ìœ¨ì´ ì¦‰ì‹œ ê¸‰ê°"],
    a: 3,
    explain: "ì§€êµ¬ì˜¨ë‚œí™”ëŠ” ì—¬ëŸ¬ ì˜í–¥ì„ ë¯¸ì¹˜ì§€ë§Œ, ëŒ€ê¸° ì¤‘ ì‚°ì†Œ ë¹„ìœ¨ì´ ì¦‰ì‹œ ê¸‰ê°í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤."
  },
  {
    q: "ìì—° ìƒíƒœê³„ì˜ 'ìƒì‚°ì'ì— í•´ë‹¹í•˜ëŠ” ê²ƒì€?",
    choices: ["ì´ˆì‹ë™ë¬¼", "ë¶„í•´ì(ì˜ˆ: ë°•í…Œë¦¬ì•„)", "ê´‘í•©ì„±ì„ í•˜ëŠ” ì‹ë¬¼", "ìœ¡ì‹ë™ë¬¼"],
    a: 2,
    explain: "ìƒì‚°ìëŠ” íƒœì–‘ ì—ë„ˆì§€ë¥¼ ì´ìš©í•´ ìœ ê¸°ë¬¼ì„ ìƒì‚°í•˜ëŠ” ê´‘í•©ì„± ìƒë¬¼ì„ ë§í•œë‹¤."
  },
  {
    q: "ì§€ì†ê°€ëŠ¥í•œ ë°œì „(sustainable development)ì˜ ì„¸ ê°€ì§€ ì¶•ì— í¬í•¨ë˜ì§€ ì•ŠëŠ” ê²ƒì€?",
    choices: ["í™˜ê²½ ë³´ì „", "ê²½ì œ ì„±ì¥", "ì‚¬íšŒì  í˜•í‰ì„±", "ì¼ì‹œì  ê°œë°œ ì´ìµ"],
    a: 3,
    explain: "ì§€ì†ê°€ëŠ¥ì„±ì€ í™˜ê²½, ê²½ì œ, ì‚¬íšŒì  í˜•í‰ì„±(ì„¸ ì¶•)ì„ ê· í˜• ìˆê²Œ ê³ ë ¤í•œë‹¤."
  },
  {
    q: "í•´ì–‘ í”Œë¼ìŠ¤í‹± ë¬¸ì œì—ì„œ 'ë¯¸ì„¸í”Œë¼ìŠ¤í‹±'ì˜ ì£¼ëœ ìœ„í—˜ì€?",
    choices: ["í”Œë¼ìŠ¤í‹±ì´ ë¬¼ì˜ ì˜¨ë„ ìƒìŠ¹ì„ ì´ˆë˜", "í”Œë¼ìŠ¤í‹±ì´ ì˜ì–‘ë¶„ì„ ê³µê¸‰", "í•´ì–‘ ìƒë¬¼ì˜ ì²´ë‚´ ì¶•ì  ë° ì‹í’ˆë§ ì˜¤ì—¼", "í•´ë¥˜ë¥¼ ë©ˆì¶”ê²Œ í•¨"],
    a: 2,
    explain: "ë¯¸ì„¸í”Œë¼ìŠ¤í‹±ì€ ìƒë¬¼ì²´ ë‚´ì— ì¶•ì ë˜ê³  ë¨¹ì´ì‚¬ìŠ¬ì„ í†µí•´ ì¸ê°„ì—ê²Œë„ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤."
  },
  {
    q: "ì™¸ë˜ì¢…(invasive species)ì´ ìƒíƒœê³„ì— ë¯¸ì¹˜ëŠ” ë¶€ì •ì  ì˜í–¥ìœ¼ë¡œ ì˜³ì§€ ì•Šì€ ê²ƒì€?",
    choices: ["í† ì°©ì¢… ë©¸ì¢… ì••ë ¥ ì¦ê°€", "ë³‘í•´ì¶© í™•ì‚°", "ìƒíƒœê³„ ì„œë¹„ìŠ¤ í–¥ìƒ", "ìƒë¬¼ë‹¤ì–‘ì„± ê°ì†Œ"],
    a: 2,
    explain: "ì™¸ë˜ì¢…ì€ ì¼ë°˜ì ìœ¼ë¡œ ìƒíƒœê³„ë¥¼ íŒŒê´´í•˜ê³  ì„œë¹„ìŠ¤ì™€ ë‹¤ì–‘ì„±ì„ ë–¨ì–´ëœ¨ë¦´ ìˆ˜ ìˆì§€ë§Œ, 'í–¥ìƒ'ì„ ì¼ìœ¼í‚¤ëŠ” ê²½ìš°ëŠ” ë“œë¬¼ë‹¤."
  },
  {
    q: "íƒ„ì†Œì¤‘ë¦½(carbon neutrality)ì˜ ì •ì˜ë¡œ ì˜³ì€ ê²ƒì€?",
    choices: ["ë°°ì¶œí•˜ëŠ” íƒ„ì†Œë¥¼ ëª¨ë‘ í¬ì§‘í•˜ëŠ” ê²ƒë§Œì„ ì˜ë¯¸", "ë°°ì¶œëŸ‰ê³¼ ì œê±°ëŸ‰ì„ ê°™ê²Œ ë§Œë“¤ì–´ ìˆœ ë°°ì¶œì„ 0ìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒ", "í™”ì„ì—°ë£Œë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒ", "íƒ„ì†Œ ë°°ì¶œì„ ë¬´ì œí•œ í—ˆìš©í•˜ëŠ” ê²ƒ"],
    a: 1,
    explain: "íƒ„ì†Œì¤‘ë¦½ì€ ë°°ì¶œëŸ‰ê³¼ ì œê±°ëŸ‰ì„ ê°™ê²Œ í•˜ì—¬ ìˆœ ë°°ì¶œì„ 0ìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤."
  }
];

let currentIndex = 0;
let score = 0;
let correct = 0;
let wrong = 0;
let answered = Array(QUESTIONS.length).fill(false);
const total = QUESTIONS.length;

/* DOM refs */
const qnum = document.getElementById('qnum');
const questionEl = document.getElementById('question');
const choicesEl = document.getElementById('choices');
const progressBar = document.getElementById('progress');
const progressPercent = document.getElementById('progress-percent');
const metaQ = document.getElementById('meta-q');
const metaScore = document.getElementById('meta-score');
const statCorrect = document.getElementById('stat-correct');
const statWrong = document.getElementById('stat-wrong');
const btnNext = document.getElementById('btn-next');
const btnSkip = document.getElementById('btn-skip');
const btnRestart = document.getElementById('btn-restart');
const btnExplain = document.getElementById('btn-explain');
const result = document.getElementById('result');
const resultTitle = document.getElementById('result-title');
const finalScore = document.getElementById('final-score');
const finalPercent = document.getElementById('final-percent');
const finalHigh = document.getElementById('final-high');
const highscoreEl = document.getElementById('highscore');
const btnPlayAgain = document.getElementById('btn-play-again');
const btnCloseResult = document.getElementById('btn-close-result');
const difficulty = document.getElementById('difficulty');

/* init */
function loadHighscore(){
  const h = Number(localStorage.getItem('ecoquiz_high') || 0);
  highscoreEl.textContent = h;
  finalHigh.textContent = h;
}
loadHighscore();

function shuffleQuestions(){
  // simple Fisher-Yates shuffle to randomize order once
  for(let i=QUESTIONS.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [QUESTIONS[i],QUESTIONS[j]]=[QUESTIONS[j],QUESTIONS[i]];
  }
}
shuffleQuestions();

/* render current question */
function render(){
  const q = QUESTIONS[currentIndex];
  qnum.textContent = currentIndex + 1;
  metaQ.textContent = currentIndex + 1;
  questionEl.textContent = q.q;
  // difficulty: derive from index
  difficulty.textContent = "ë‚œì´ë„: " + (currentIndex<3 ? "ì‰¬ì›€" : currentIndex<7 ? "ë³´í†µ" : "ì–´ë ¤ì›€");
  choicesEl.innerHTML = '';
  q.choices.forEach((c,i)=>{
    const div = document.createElement('div');
    div.className = 'choice';
    div.setAttribute('data-index', i);
    div.setAttribute('role','option');
    div.innerHTML = `
      <div class="label">${['A','B','C','D'][i]}</div>
      <div class="text">${c}</div>
    `;
    div.addEventListener('click', ()=> selectChoice(i));
    choicesEl.appendChild(div);
  });

  updateProgress();
  updateMeta();
  // focus for accessibility
  document.getElementById('main').focus();
}

/* when user selects an answer */
let selectionLocked = false;
function selectChoice(index){
  if(selectionLocked) return;
  selectionLocked = true;
  answered[currentIndex] = true;
  const q = QUESTIONS[currentIndex];
  const nodes = Array.from(document.querySelectorAll('.choice'));
  nodes.forEach(n => {
    const idx = Number(n.getAttribute('data-index'));
    n.classList.remove('correct','wrong');
    n.style.pointerEvents = 'none';
    if(idx === q.a){
      n.classList.add('correct');
    }
    if(idx === index && idx !== q.a){
      n.classList.add('wrong');
    }
  });

  if(index === q.a){
    score += 10;
    correct++;
    document.getElementById('meta-score').textContent = score;
    statCorrect.textContent = correct;
  } else {
    wrong++;
    statWrong.textContent = wrong;
  }
  updateProgress();

  // show explanation in small toast area if desired
  showExplain(q.explain);

  // allow next
  setTimeout(()=>{ selectionLocked=false; }, 250);
}

/* show explanation briefly */
function showExplain(text){
  // reuse btn-explain label to show message briefly
  const original = btnExplain.textContent;
  btnExplain.textContent = 'í•´ì„¤: ' + text;
  setTimeout(()=> btnExplain.textContent = original, 5000);
}

/* next question */
function next(){
  if(currentIndex < total - 1){
    currentIndex++;
    render();
  } else {
    finish();
  }
}

/* skip works like marking as wrong and moving on */
function skip(){
  if(answered[currentIndex]){ next(); return; }
  answered[currentIndex] = true;
  wrong++;
  statWrong.textContent = wrong;
  updateProgress();
  next();
}

function restart(){
  if(!confirm('ì²˜ìŒë¶€í„° ë‹¤ì‹œ í• ë˜?')) return;
  // reset state
  currentIndex = 0;
  score = 0;
  correct = 0;
  wrong = 0;
  answered = Array(QUESTIONS.length).fill(false);
  document.getElementById('meta-score').textContent = score;
  statCorrect.textContent = 0;
  statWrong.textContent = 0;
  shuffleQuestions();
  render();
  result.classList.remove('show');
  result.setAttribute('aria-hidden','true');
}

/* finish */
function finish(){
  result.classList.add('show');
  result.setAttribute('aria-hidden','false');
  resultTitle.textContent = 'í€´ì¦ˆ ì™„ë£Œ!';
  finalScore.textContent = `${score} / ${total * 10}`;
  const percent = Math.round((correct/total)*100);
  finalPercent.textContent = percent + '%';

  // update highscore
  const prev = Number(localStorage.getItem('ecoquiz_high') || 0);
  if(score > prev){
    localStorage.setItem('ecoquiz_high', score);
    finalHigh.textContent = score;
    highscoreEl.textContent = score;
    resultTitle.textContent = 'ì‹ ê¸°ë¡! ğŸ‰';
  } else {
    finalHigh.textContent = prev;
  }
}

/* update progress bar & percent */
function updateProgress(){
  const p = Math.round(((currentIndex) / (total - 1)) * 100);
  progressBar.style.width = (p) + '%';
  progressPercent.textContent = p + '%';
}

/* update meta UI */
function updateMeta(){
  metaQ.textContent = currentIndex + 1;
  qnum.textContent = currentIndex + 1;
}

/* keyboard support */
document.addEventListener('keydown', (e)=>{
  if(result.classList.contains('show')) return; // ignore when result shown
  if(e.key >= '1' && e.key <= '4'){
    const index = Number(e.key) - 1;
    const choice = document.querySelector(`.choice[data-index="${index}"]`);
    if(choice) choice.click();
  } else if(e.key === 'Enter'){
    // if current question unanswered, go to next only if already answered
    if(answered[currentIndex]) next();
    else {
      // attempt to auto-next if any selection marked
      // nothing to do
    }
  } else if(e.key === 'ArrowRight'){
    next();
  } else if(e.key === 's' || e.key === 'S'){
    skip();
  }
});

/* button handlers */
btnNext.addEventListener('click', ()=> {
  if(answered[currentIndex]) next();
  else {
    // if not answered, treat as skip
    if(confirm('ì•„ì§ ì •ë‹µì„ ì„ íƒí•˜ì§€ ì•Šì•˜ì–´. ê±´ë„ˆë›°ê³  ë‹¤ìŒìœ¼ë¡œ ê°ˆë˜?')){
      skip();
    }
  }
});
btnSkip.addEventListener('click', skip);
btnRestart.addEventListener('click', restart);
btnExplain.addEventListener('click', ()=> {
  const q = QUESTIONS[currentIndex];
  alert('í•´ì„¤:\n\n' + q.explain);
});
btnPlayAgain.addEventListener('click', ()=> {
  restart();
});
btnCloseResult.addEventListener('click', ()=> {
  result.classList.remove('show');
  result.setAttribute('aria-hidden','true');
});

/* initial render */
render();

</script>
</body>
</html>
